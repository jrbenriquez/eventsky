{% extends "base.html" %} {% block body %}
<div class="mx-auto max-w-3xl px-4 py-6 space-y-6">
  <!-- Page title + actions -->
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-bold tracking-tight text-slate-900">
      Manage: {{ event.title or "Event" }}
    </h1>
    <a
      href="/events/"
      class="rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-medium text-slate-700 shadow-sm hover:border-gray-400 hover:shadow-md"
    >
      < Back to Events
    </a>
    <a
      href="/events/{{ event.code }}/"
      class="rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-medium text-slate-700 shadow-sm hover:border-gray-400 hover:shadow-md"
    >
      View Event >
    </a>
  </div>

  <!-- Section 1: Edit form -->
  <section class="rounded-xl border border-slate-200 bg-white p-4 sm:p-6">
    <div class="mb-4">
      <h2 class="text-lg font-semibold text-slate-900">Event Details</h2>
      <p class="mt-1 text-sm text-slate-500">
        Update basics and message posting settings.
      </p>
    </div>

    <form method="post" action="/manage/events/{{ event.uuid }}/">
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />

      <div class="grid grid-cols-1 gap-4 sm:gap-5">
        <!-- Code -->
        <div>
          <label for="code" class="block text-sm font-medium text-slate-700"
            >Code</label
          >
          <input
            id="code"
            name="code"
            type="text"
            value="{{ event.code }}"
            class="mt-1 w-full shadow-sm px-2"
            placeholder="e.g. WED2025"
          />
          <p class="mt-1 text-xs text-slate-500">
            Short unique identifier for the event URL.
          </p>
        </div>

        <!-- Title -->
        <div>
          <label for="title" class="block text-sm font-medium text-slate-700"
            >Title</label
          >
          <input
            id="title"
            name="title"
            type="text"
            value="{{ event.title }}"
            class="mt-1 w-full shadow-sm px-2"
            placeholder="Event title"
          />
        </div>

        <!-- Description -->
        <div>
          <label
            for="description"
            class="block text-sm font-medium text-slate-700"
            >Description</label
          >
          <textarea
            id="description"
            name="description"
            rows="4"
            class="mt-1 w-full shadow-sm px-2"
            placeholder="Brief details about the event"
          >
{{ event.description or "" }}</textarea
          >
        </div>

        <!-- Event date -->
        <div>
          <label
            for="event_date"
            class="block text-sm font-medium text-slate-700"
            >Event Date</label
          >
          <input
            id="event_date"
            name="event_date"
            type="date"
            value="{{ event.event_date.strftime('%Y-%m-%d') if event.event_date }}"
            class="mt-1 w-full border-gray-400 shadow-sm focus:border-gray-400 focus:ring-gray-400"
          />
        </div>

        <!-- Posting disabled -->
        <div class="flex items-start gap-3">
          <input
            id="posting_messages_disabled"
            name="posting_messages_disabled"
            type="checkbox"
            class="mt-1 h-4 w-4 rounded border-gray-400 text-black focus:ring-gray-400"
            {%
            if
            event.posting_messages_disabled
            %}checked{%
            endif
            %}
          />
          <div>
            <label
              for="posting_messages_disabled"
              class="text-sm font-medium text-slate-700"
            >
              Disable new message posting
            </label>
            <p class="text-sm text-slate-500">
              Guests won't be able to post while this is enabled.
            </p>
          </div>
        </div>

        <!-- Disabled text -->
        <div>
          <label
            for="posting_messages_disabled_text"
            class="block text-sm font-medium text-slate-700"
          >
            Message shown when posting is disabled
          </label>
          <textarea
            id="posting_messages_disabled_text"
            name="posting_messages_disabled_text"
            rows="3"
            class="mt-1 w-full border-gray-400 shadow-sm focus:border-gray-400 focus:ring-gray-400"
            placeholder="Sorry, posting is temporarily disabled. Please check back later."
          >
{{ event.posting_messages_disabled_text or "" }}</textarea
          >
        </div>
      </div>

      <!-- Form actions -->
      <div class="mt-6 flex items-center gap-3">
        <button
          type="submit"
          class="inline-flex items-center rounded-lg bg-black px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
        >
          Save Changes
        </button>
        <a
          href="/events/{{ event.code }}/"
          class="text-sm font-medium text-slate-600 hover:text-slate-900"
        >
          Cancel
        </a>
      </div>
    </form>
  </section>

  <!-- Section 2: Messages list -->
  <section class="rounded-xl border border-slate-200 bg-white p-4 sm:p-6">
    <div class="mb-4">
      <h2 class="text-lg font-semibold text-slate-900">Messages</h2>
      <p class="mt-1 text-sm text-slate-500">Recent posts for this event.</p>
    </div>

    <div
      id="messages"
      class="w-full flex-1 overflow-y-auto mx-auto pt-8 px-4 space-y-3 max-w-xl sm:max-w-2xl lg:max-w-3xl scrollbar-width:none] [-ms-overflow-style:none] [&::-webkit-scrollbar]:hidden"
    >
      {% include "_messages.html" %} {% if messages %}
      <div
        id="infinite-scroll"
        hx-get="/events/{{ event.code }}/check_older/?before_id={{ messages[-1].uuid }}&limit=10"
        hx-trigger="load"
        hx-swap="outerHTML"
      ></div>
      {% endif %}
    </div>
  </section>
</div>

<!-- Optional: small enhancement so the disabled-text field grays out when checkbox is off -->
<script>
  (function () {
    const cb = document.getElementById("posting_messages_disabled");
    const txt = document.getElementById("posting_messages_disabled_text");
    function toggle() {
      const on = cb.checked;
      txt.disabled = !on;
      txt.classList.toggle("bg-slate-50", !on);
    }
    if (cb && txt) {
      cb.addEventListener("change", toggle);
      toggle();
    }
  })();
</script>
{% endblock %}
